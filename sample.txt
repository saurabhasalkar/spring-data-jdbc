import java.time.LocalDate;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;

public interface WorkflowExecutionRepository {

    @Query("""
        SELECT new com.example.dto.WorkflowInstanceDto(wi)
        FROM WorkflowExecution wi
        WHERE wi.status = com.example.domain.WorkflowExecution.WorkflowStatus.RUNNING
          AND (:workflowId IS NULL OR wi.workflowDefinition.id = :workflowId)
          AND (:businessDate IS NULL OR wi.businessDate = :businessDate)
          AND (:initiatedBy IS NULL OR wi.initiatedBy.userId = :initiatedBy)
        """)
    Page<WorkflowInstanceDto> findRunningWorkflows(
            Pageable pageable,
            @Param("workflowId") String workflowId,
            @Param("businessDate") LocalDate businessDate,
            @Param("initiatedBy") String initiatedBy
    );
}