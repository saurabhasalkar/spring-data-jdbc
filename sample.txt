public interface WorkflowExecutionRepository extends JpaRepository<WorkflowExecution, String> {

    @Query("""
        SELECT wi
        FROM WorkflowExecution wi
        WHERE wi.status = com.example.domain.WorkflowExecution.WorkflowStatus.RUNNING
          AND (:workflowId IS NULL OR wi.workflowDefinition.id = :workflowId)
          AND (:businessDate IS NULL OR wi.businessDate = :businessDate)
          AND (:initiatedBy IS NULL OR wi.initiatedBy.userId = :initiatedBy)
        """)
    Page<WorkflowExecution> findRunningWorkflows(
            Pageable pageable,
            @Param("workflowId") String workflowId,
            @Param("businessDate") LocalDate businessDate,
            @Param("initiatedBy") String initiatedBy
    );
}